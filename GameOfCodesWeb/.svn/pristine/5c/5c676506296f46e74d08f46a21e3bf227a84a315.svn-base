package com.misys.gameofcodes.api;

import java.util.Set;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

import org.bson.types.ObjectId;

import com.misys.gameofcodes.connection.MongoClientProvider;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.DBCursor;
import com.mongodb.MongoClient;
import com.misys.gameofcodes.model.*;
import com.misys.gameofcodes.service.HeroService;

@Path("/hero")  
public class Hero {
  // This method is called if HTML and XML is not requested  
  @GET  
  @Produces(MediaType.TEXT_PLAIN)  
  public String sayPlainTextHello() {  
    return "Hello Jersey Plain";  
  }  
  // This method is called if XML is requested  
  @GET  
  @Produces(MediaType.TEXT_XML)  
  public String sayXMLHello() {  
	  
    	MongoClient mongoClient = MongoClientProvider.getMongoClient();
		DB db = mongoClient.getDB("GameOfCodes");
		DBCollection collection = db.getCollection("heroes");
		System.out.println("OOOOOOOOOOOOOOOOOOOOO");
		
		DBCursor cursor = collection.find();
		while(cursor.hasNext()) {
		    System.out.println(cursor.next().toString());
		}
    return "<?xml version=\"1.0\"?>" + "<hello> Hello Jersey" + "</hello>";  
  }  
  
  // This method is called if HTML is requested  
  @GET  
  @Produces(MediaType.TEXT_HTML)  
  public String sayHtmlHello() {  
	  
	  
	  com.misys.gameofcodes.model.Hero hero = new com.misys.gameofcodes.model.Hero();
	 	  
	  hero.setId(new ObjectId());
	  
	  HeroService hs = HeroService.getHeroService();
	  
	  hero = hs.fetchHero(hero);

	 
	  
	  
	  
      	MongoClient mongoClient = MongoClientProvider.getMongoClient();
		DB db = mongoClient.getDB("GameOfCodes");
		DBCollection collection = db.getCollection("heroes");
		
		System.out.println(collection.find().toString());
		
		StringBuilder sb = new StringBuilder();
		DBCursor cursor = collection.find();
		while(cursor.hasNext()) {
		    sb.append(cursor.next().toString());
		}
		
    return  "<html><body>"+hero.getName()+"</body></html>";  
  }   
}  